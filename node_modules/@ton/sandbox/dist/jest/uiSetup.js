"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const crypto_1 = require("crypto");
const Blockchain_1 = require("../blockchain/Blockchain");
const ManagedWebSocketConnector_1 = require("../ui/connection/websocket/ManagedWebSocketConnector");
let websocketConnector;
beforeAll(() => {
    const originalCreate = Blockchain_1.Blockchain.create.bind(Blockchain_1.Blockchain);
    Blockchain_1.Blockchain.create = async (...args) => {
        let [opts, ...otherArgs] = args;
        if (!opts?.uiOptions?.connector) {
            if (!websocketConnector) {
                websocketConnector = new ManagedWebSocketConnector_1.ManagedWebSocketConnector(opts?.uiOptions);
                // eslint-disable-next-line no-console
                console.log('Connecting to websocket connector...');
                await websocketConnector.connect();
            }
            opts = {
                ...opts,
                uiOptions: {
                    ...opts?.uiOptions,
                    enabled: true,
                    connector: websocketConnector,
                },
            };
        }
        return await originalCreate(opts, ...otherArgs);
    };
});
beforeEach(() => {
    expect.setState({ testId: (0, crypto_1.randomUUID)() });
});
afterEach(() => {
    expect.setState({ testId: undefined });
});
afterAll(() => {
    websocketConnector?.disconnect();
});
