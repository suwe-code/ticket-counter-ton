"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.findInstructionInfo = findInstructionInfo;
/**
 * Finds the instruction in the assembly mapping by hash+offset pair.
 *
 * Hash and offset is a standard representation in TVM used by TVM logs and in emulator.
 *
 * @param mapping  assembly mapping from Source Map
 * @param hash     Cell hash from logs or TVM
 * @param offset   offset in Cell from logs or TVM
 */
function findInstructionInfo(mapping, hash, offset) {
    // Cell hash can be both Dictionary Cell hash or just a regular code Cell hash
    // We try to find the Dictionary Cell in the mapping first
    const dictCell = mapping.dictionaryCells.find(it => it.cell === hash);
    // And if we found it, we use not Dictionary Cell hash,
    // but the data Cell hash that we stored in the mapping
    const [targetCellHash, targetOffset] = dictCell
        ? [dictCell.dataCell, dictCell.offset]
        : [hash, 0];
    const cell = mapping.cells[targetCellHash];
    if (!cell) {
        // no luck, we don't have this cell in the mapping
        return undefined;
    }
    // Important note: we need to shift the step offset that we have in the log
    // since in the code Cell we start from the 0, while in logs it starts from the offset
    // of the code Cell in the Dictionary Cell
    const instrIndex = cell.instructions.findIndex(it => it.offset === offset - targetOffset);
    return [cell.instructions, instrIndex];
}
//# sourceMappingURL=assembly-mapping.js.map